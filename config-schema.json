{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Dynamic MCP Configuration",
  "description": "Configuration schema for dynamic-mcp proxy server",
  "type": "object",
  "required": ["mcpServers"],
  "additionalProperties": false,
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference (optional, for IDE validation)"
    },
    "mcpServers": {
      "type": "object",
      "description": "Map of server names to their configurations",
      "additionalProperties": {
        "oneOf": [
          {
            "type": "object",
            "description": "stdio transport server configuration (command-based)",
            "required": ["description", "command"],
            "additionalProperties": false,
            "properties": {
              "type": {
                "type": "string",
                "enum": ["stdio"],
                "description": "Transport type (optional, defaults to stdio if command is present)"
              },
              "description": {
                "type": "string",
                "description": "Description of what this server does (shown to LLM for routing decisions)"
              },
              "command": {
                "type": "string",
                "description": "Command to execute (e.g., 'npx', 'node', 'python')"
              },
              "args": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Command arguments (supports ${VAR} environment variable syntax)"
              },
              "env": {
                "type": "object",
                "additionalProperties": {
                  "type": "string"
                },
                "description": "Environment variables (supports ${VAR} syntax for variable substitution)"
              },
               "features": {
                 "type": "object",
                 "additionalProperties": false,
                 "description": "Feature flags (all enabled by default if omitted)",
                 "properties": {
                   "tools": {
                     "type": "boolean",
                     "default": true,
                     "description": "Enable tools from this server"
                   },
                   "resources": {
                     "type": "boolean",
                     "default": true,
                     "description": "Enable resources from this server"
                   },
                   "prompts": {
                     "type": "boolean",
                     "default": true,
                     "description": "Enable prompts from this server"
                   }
                 }
               },
               "enabled": {
                 "type": "boolean",
                 "default": true,
                 "description": "Enable or disable this server (default: true)"
               },
               "timeout": {
                  "type": "object",
                  "additionalProperties": false,
                  "description": "Timeout configuration for this server",
                  "properties": {
                    "tools": {
                      "oneOf": [
                        { "type": "string", "description": "Tool call timeout as duration string (e.g., '30s', '1min', '500ms')" },
                        { "type": "integer", "minimum": 0, "description": "Tool call timeout in seconds" }
                      ],
                      "default": "30s",
                      "description": "Timeout for tool calls (default: 30s)"
                    },
                    "resources": {
                      "oneOf": [
                        { "type": "string", "description": "Resource call timeout as duration string (e.g., '30s', '1min', '500ms')" },
                        { "type": "integer", "minimum": 0, "description": "Resource call timeout in seconds" }
                      ],
                      "default": "10s",
                      "description": "Timeout for resource calls (default: 10s)"
                    },
                    "prompts": {
                      "oneOf": [
                        { "type": "string", "description": "Prompt call timeout as duration string (e.g., '30s', '1min', '500ms')" },
                        { "type": "integer", "minimum": 0, "description": "Prompt call timeout in seconds" }
                      ],
                      "default": "10s",
                      "description": "Timeout for prompt calls (default: 10s)"
                    }
                  }
                }
              }
            },
             {
              "type": "object",
              "description": "HTTP/SSE transport server configuration (url-based, type is optional and defaults to http with automatic SSE detection)",
              "required": ["description", "url"],
              "additionalProperties": false,
              "properties": {
                "type": {
                  "type": "string",
                  "enum": ["http", "sse"],
                  "description": "Transport type (optional: omit for automatic detection, 'http' for HTTP-only, 'sse' for SSE-only)"
                },
               "description": {
                 "type": "string",
                 "description": "Description of what this server does (shown to LLM for routing decisions)"
               },
               "url": {
                 "type": "string",
                 "format": "uri",
                 "description": "HTTP endpoint URL (supports ${VAR} environment variable syntax)"
               },
               "headers": {
                 "type": "object",
                 "additionalProperties": {
                   "type": "string"
                 },
                 "description": "HTTP headers (supports ${VAR} syntax for variable substitution)"
               },
               "oauth_client_id": {
                 "type": "string",
                 "description": "OAuth2 client ID for authentication (triggers OAuth flow)"
               },
               "oauth_scopes": {
                 "type": "array",
                 "items": {
                   "type": "string"
                 },
                 "description": "OAuth2 scopes to request during authentication"
               },
               "features": {
                 "type": "object",
                 "additionalProperties": false,
                 "description": "Feature flags (all enabled by default if omitted)",
                 "properties": {
                   "tools": {
                     "type": "boolean",
                     "default": true,
                     "description": "Enable tools from this server"
                   },
                   "resources": {
                     "type": "boolean",
                     "default": true,
                     "description": "Enable resources from this server"
                   },
                   "prompts": {
                     "type": "boolean",
                     "default": true,
                     "description": "Enable prompts from this server"
                   }
                 }
               },
                "enabled": {
                  "type": "boolean",
                  "default": true,
                  "description": "Enable or disable this server (default: true)"
                },
                "timeout": {
                  "type": "object",
                  "additionalProperties": false,
                  "description": "Timeout configuration for this server",
                  "properties": {
                    "tools": {
                      "oneOf": [
                        { "type": "string", "description": "Tool call timeout as duration string (e.g., '30s', '1min', '500ms')" },
                        { "type": "integer", "minimum": 0, "description": "Tool call timeout in seconds" }
                      ],
                      "default": "30s",
                      "description": "Timeout for tool calls (default: 30s)"
                    },
                    "resources": {
                      "oneOf": [
                        { "type": "string", "description": "Resource call timeout as duration string (e.g., '30s', '1min', '500ms')" },
                        { "type": "integer", "minimum": 0, "description": "Resource call timeout in seconds" }
                      ],
                      "default": "10s",
                      "description": "Timeout for resource calls (default: 10s)"
                    },
                    "prompts": {
                      "oneOf": [
                        { "type": "string", "description": "Prompt call timeout as duration string (e.g., '30s', '1min', '500ms')" },
                        { "type": "integer", "minimum": 0, "description": "Prompt call timeout in seconds" }
                      ],
                      "default": "10s",
                      "description": "Timeout for prompt calls (default: 10s)"
                    }
                  }
                }
              }
           }
        ]
      }
    }
  }
}
